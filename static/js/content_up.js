(function(){function r(){if(document.getElementById("s_menu"))return;$("#hk_layer")[0]||$(document.body).append($('<div id="hk_layer"><div id="hk_tpl_btn1"><div class="no-img-byextension"></div></div><div id="drag_area_byextension"><div class="drag-area-img"></div><div class="drag-area-text">\u62d6\u52a8\u6587\u4ef6\u5230\u8fd9\u91cc\u8bd5\u8bd5</div></div><ul id="hk_wallpapers"></ul></div>')).append($('<div id="bg_entrance_byextension" class="hk_tip" style="display: block;"></div>')),$("#hk_tpl_btn1").after($(""))}function i(){$("#bg_entrance_byextension").click(function(e){$("#hk_layer").toggleClass("layer_display"),e.stopPropagation()})}function s(){var e=$('<div id="addtobaidu_by_extension" class="addtobaidu-by-extension"><a href="javascript:;" onclick="return false;">\u8bbe\u7f6e\u4e3a\u767e\u5ea6\u9996\u9875\u80cc\u666f</a></div>');$(document.body).append(e),e.click(function(e){chrome.extension.sendMessage({imgurl:$("#zoomLinkBt").attr("href")},function(e){}),document.getElementById("dialog_by_extension")||$(document.body).append($('<div id="dialog_by_extension"><p style="width: 100px;margin: auto;height: 40px;line-height: 40px;font-size: 14px;">\u53bb<a id="add_btn_byextension" href="http://www.baidu.com/" target="_blank" style="font-size: 14px;color:#165b85;">\u767e\u5ea6\u9996\u9875</a>\u770b\u770b</p></div>')),$("#dialog_by_extension").dialog({title:"\u8bbe\u7f6e\u6210\u529f",modal:!0,show:{effect:"fade",duration:300},buttons:{"\u786e\u5b9a":function(){var e=$(this).dialog("close");$(".ui-dialog.ui-widget").remove()}}}),$("#dialog_by_extension #add_btn_byextension").click(function(){$("#dialog_by_extension").dialog("close"),$(".ui-dialog.ui-widget").remove()}),setTimeout(function(){$("#dialog_by_extension")[0]&&($("#dialog_by_extension").dialog("close"),$("#dialog_by_extension").remove())},2e3)})}function o(e){if(e){if(document.getElementById("s_menu"))return;$("#hk_layer .xiangce-btn")[0]||$("#hk_layer").append("<a class='xiangce-btn' target='_blank' href='http://xiangce.baidu.com/'></a>"),$("#hk_wallpapers").empty();if(e.filenames){var t=e.filenames.split("@"),n=$("#hk_wallpapers");$.each(t,function(e,t){n.append($("<li></li>").append($("<img width='123' height='90' src='"+t+"'></img><div class='img-add'>\u8bbe\u7f6e\u4e3a\u9875\u9762\u80cc\u666f</div>")))})}else h()}l(e),u()}function u(){$("#hk_tpl_btn1").click(function(e){chrome.extension.sendMessage({clear:"true"})}),$("#hk_wallpapers img").click(function(e){chrome.extension.sendMessage({imgurl:$(this).attr("src")})})}function a(e){if(e&&e.shadowflag!==undefined){var n=t[e.shadowflag?0:1].fontcolor,r=t[e.shadowflag?0:1].logimg;if(e.imgurl){document.body.style.backgroundRepeat="no-repeat",document.body.style.backgroundPosition="center top";if(document.getElementById("s_menu"))return;document.body.style.backgroundSize="cover",document.body.className="classicbaidu-by-extension-"+n,$("#lg img").attr({src:"chrome-extension://"+chrome.i18n.getMessage("@@extension_id")+"/static/img/"+r}),document.body.style.backgroundImage='url("'+e.imgurl+'")',setTimeout(function(){$("#u_level").css({color:n?n:"black"})},800)}else f()}}function f(){document.body.style.backgroundImage="",document.body.className="",$("#u_level").css({color:"black"}),document.getElementById("s_menu")?$("#lg .fluxslider .image1")[0]?$("#lg .fluxslider .image1").css({backgroundImage:"url("+n+")"}):$("#lg img").attr({src:n}):$("#lg img").attr({src:n})}function l(e){var t=e.imgurl,n=e.isdefaultflag;if(t){c();if(n)$("#hk_tpl_btn2").append($('<div class="add-tag">'));else if(e.filenames){var r=(e.filenames.split("@")||"").indexOf(t);$("#hk_wallpapers>li:eq("+r+")").append($('<div class="add-tag">'))}}else c()}function c(){$("#hk_tpl_btn2 .add-tag").remove(),$("#hk_layer .add-tag").remove()}function h(){$("#hk_wallpapers").append($("<p class='big-white'>\u5b9a\u5236\u4e13\u5c5e\u60a8\u7684\u767e\u5ea6\u9996\u9875</p>")).append($("<p class='small-black'>\u4e00\u952e\u641e\u5b9a\uff0c\u767e\u5ea6\u4e3a\u60a8\u66f4\u667a\u80fd\u5730\u63d0\u4f9b\u4e2a\u6027\u5316\u670d\u52a1</p>"))}function p(){$("#hk_wallpapers").empty()}function w(e){while(!E(e))e=e.parentNode;return!e||e==document.body?!0:!1}function E(e){return!e||$(e).attr("id")=="hk_layer"||e==document.body}var t=[{fontcolor:"white",logimg:"logo_baidu_white.png"},{fontcolor:"",logimg:"logo_baidu_light.png"}],n="http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif";location.host=="www.baidu.com"||location.host=="www.spacefe.baidu.com"||location.host=="yulan.baidu.com"?(r(),i(),chrome.extension.sendMessage({defaultimg:$("#hk_tpl_btn2").attr("data-src"),isfirstinit:"true"},function(e){o(e)})):location.host=="xiangce.baidu.com"&&s();if(window.FileReader){var d=document.getElementById("drag_area_byextension");function v(e){switch(e){case"image/jpeg":case"image/png":case"image/gif":case"image/bmp":case"image/jpg":return!0;default:return!1}}function m(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;for(var n=0,r;r=t[n];n++){var i=r.type?r.type:"n/a",s=new FileReader,o=v(i);o?(s.onload=function(e){return function(e){chrome.extension.sendMessage({imgurl:e.target.result})}}(r),s.readAsDataURL(r)):alert("\u4eb2\uff0c\u4f60\u4f20\u8fdb\u6765\u7684\u4e0d\u662f\u56fe\u7247\uff01\uff01")}}function g(e){$("#drag_area_byextension .drag-area-img").css({borderStyle:"dashed"})}function y(e){$("#drag_area_byextension .drag-area-img").css({borderStyle:""})}function b(e){e.stopPropagation(),e.preventDefault()}d&&(d.addEventListener("dragenter",g,!1),d.addEventListener("dragover",b,!1),d.addEventListener("drop",m,!1),d.addEventListener("dragleave",y,!1))}chrome.extension.onMessage.addListener(function(e){a(e),o(e)}),document.body.addEventListener("click",function(e){$("#hk_layer").hasClass("layer_display")&&w(e.target)&&$("#hk_layer").removeClass("layer_display")},!1)})();